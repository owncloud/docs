# Building the Documentation

You're now ready to build (generate) the ownCloud documentation.
The documentation can be generated in HTML and PDF formats.

## Generating in HTML Format

There are two ways to generate the documentation in HTML format:

- Using the Official Docker Container
- Running Antora from the Command-Line

### Using the Docker Container

From the command line, in the root of the docs directory, run the command:

```
docker run -ti --rm \
    -v $(pwd):$(pwd) \
    -w $(pwd) \
    antora/antora:1.0.1 \
    generate site.yml
```

This command starts up the Antora Docker container, removes the existing documentation, and then runs Antora's generate command, an regenerates the documentation.
If all goes well, you will _not_ see any console output.

### Running Antora From The Command-Line

From the command line, in the root of the docs directory, run the command:

```
antora site.yml
```

If all goes well, you will _not_ see any console output.

#### Testing For Broken Xref Links

There are a host of ways to check for broken links, including NPM's broken link checker.
However, this custom generator, provided by the core Antora team, is able to check [the native Antora xref links](https://docs.antora.org/antora/1.0/asciidoc/page-to-page-xref/#xref-and-page-id-anatomy).
It doesn't check external links, but it's still a good start.
To use it, you need to pass the custom generator (in `./generator/xref-validator`) to the `generate` command, as in the example below.
```console
antora generate \
    --pull \
    --ui-bundle-url https://github.com/owncloud/docs-ui/releases/download/1.1.0/ui-bundle.zip \
    --generator=./generator/xref-validator \
    site.yml
```

If invalid xrefs are detected, then it will output them to the console, similar to the example below:
You can see that it checks all the content source repositories, and lists the file that contains the broken xref and the broken xref.

```console
Invalid Xrefs Detected:

repo: //github.com/owncloud/client | branch: master-antora | component: client | version: master
  path: docs/modules/ROOT/pages/building.adoc | xref: https://owncloud.org/download/.adoc

worktree: /ownCloud/docs | component: server | version: master
  path: modules/administration_manual/pages/maintenance/update.adoc | xref: maintenance/updated.adoc
```

### Viewing The HTML Documentation

Assuming that there are no errors, the next thing to do is to run the [NPM Serve tool](https://www.npmjs.com/package/serve) so that you can view your changes, before committing and pushing the changes to the remote docs repository.
We suggest using it, as it's trivial to install and start.
You could also use [PHP's built-in webserver](https://secure.php.net/manual/en/features.commandline.webserver.php) as well.
By using either of these, you don't have to install and configure a complete webserver, such as Apache or NGINX.

To start *Serve*, run the following command:

```
serve public &
```

This starts Serve and set it running in the background, using the `public` directory, (re)generated by `antora site.yml`, as the document root, listening on `http://localhost:5000`.
_The URL is automatically copied to the clipboard._

![Viewing the Antora docs with NPM serve](./images/viewing-the-antora-docs-with-npm-serve.png)

Open the URL in your browser of choice and you'll see two links, as below.

![The initial page in the local copy of the Antora-generated documentation](./images/antora-initial-local-page.png)

Click "**server/**", and you'll see the local copy of the documentation.

![Viewing the locally generated Antora documentation](./images/viewing-the-locally-generated-antora-documentation.png)

If you're happy with your changes, as with any other change, create a set of meaningful commits and push them to the remote repository.
If you're _not_ satisfied with the changes, however, continue to make further updates, as necessary, and run `antora site.yml` afterwards.
Your changes will be reflected in the local version of the site that Serve is rendering.

We hope that you can see that contributing to the documentation using Antora is a pretty straight-forward process, and not _that_ demanding.

## Generating in PDF Format

To generate the documentation in PDF format, you need to have `asciidoctor-pdf` and GNU `make` installed, as PDF generation isn't, _yet_, supported by Antora.
To install asciidoctor-pdf, please refer to [the official installation instructions](https://asciidoctor.org/docs/asciidoctor-pdf/).
To install GNU Make, please refer to the link below for your operating system:

- [Linux](https://www.cyberciti.biz/faq/howto-installing-gnu-c-compiler-development-environment-on-ubuntu/)
- [macOS](http://brewformulas.org/Make)
- [Microsoft Windows](http://gnuwin32.sourceforge.net/install.html)

When installed, run the command below in the root directory of the repository, to generate PDF versions of the _administration_, _developer_ and _user_ manuals.

```console
make pdf
```

`make pdf` invokes [asciidoctor-pdf](https://github.com/asciidoctor/asciidoctor-pdf) and passes it:

1. **The configuration file to use**

    This configuration file, based on [the asciidoctor-pdf theming guide](https://github.com/asciidoctor/asciidoctor-pdf/blob/master/docs/theming-guide.adoc), contains all the essential details required to build a PDF version of one of the manuals.

    This includes the list of files to use as the PDF's source material as well as the required YAML front-matter. The front-matter includes details such as whether to render a table of contents, the icon set to use, and the images base directory.

2. **The custom theme directory and the custom theme file**

    This ensures that the defaults are overridden, where relevant, to ensure that the generated PDF is as close to the current ownCloud style as possible.

When generated, the PDF files will be generated in the build directory (`build`), and will be named after the respective manual.
The build directory is called `build` and is located in the root of the repository.

## Viewing Build Errors

If an aspect of your change contains invalid AsciiDoc, then you'll see output similar to the example below.

```console
asciidoctor: ERROR: index.adoc: line 25: only book doctypes can contain level 0 sections
```

There, you can see:

- That an error was found
- The file it was found in
- The line of that file where it is located
