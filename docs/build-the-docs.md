# Building the Documentation

You're now ready to build (generate) the ownCloud documentation.
The documentation can be generated in HTML and PDF formats.

## Generating in HTML Format

There are two ways to generate the documentation in HTML format:

- Using the Official Docker Container
- Running Antora from the Command-Line

### Using the Docker Container

From the command line, in the root of the docs directory, run the command:

```
docker run -ti --rm \
    -v $(pwd):$(pwd) \
    -w $(pwd) \
    antora/antora:1.0.1 \
    generate \
        --clean \
        --pull \
        --quiet \
        --silent \
        --ui-bundle-url <url-or-path-to-ui-bundle.zip> \
        --url <site.url> \
        site.yml
```
This build command configuration:

- Suppresses all output (`--quiet` and `--silent`)
- Removes the output directory before publishing the site (`--clean`)
- Downloads updates from remote resources (`--pull`)
- Specifies a path to the desired [<abbr title="User Interface">UI</abbr> bundle](https://docs.antora.org/antora/1.0/playbook/configure-ui/#ui-bundle) (`--ui-bundle-url`)
- Specifies [the site URL](https://docs.antora.org/antora/1.0/playbook/configure-site/#configure-url) (`--url`), e.g., `http://localhost:5000`. This setting is used as a prefix for the internal URLs that Antora generates from [the Xrefs](https://docs.antora.org/antora/1.0/asciidoc/page-to-page-xref/#xref-and-page-id-anatomy), e.g., `http://localhost:5000/server/administration_manual/upgrading/marketplace_apps.html` or `file:///home/antora/workspace/owncloud/server/administration_manual/upgrading/marketplace_apps.html`.

`ui-bundle-url` is required, as this isn't specified in the production Playbook file (_which is in the root directory of the project_).
The other options, however, are optional.
If you've created a custom Playbook file, feel free to use it when running the command, in place of `site.prod.yml` (_which is in the root directory of the project_).

### Running Antora From The Command-Line

From the command line, in the root of the docs directory, run the command:

```
antora \
    --clean \
    --pull \
    --quiet \
    --silent \
    --ui-bundle-url <url-or-path-to-ui-bundle.zip> \
    --url <site.url> \
    site.prod.yml
```

This build command configuration:

- Suppresses all output (`--quiet` and `--silent`)
- Removes the output directory before publishing the site (`--clean`)
- Downloads updates from remote resources (`--pull`)
- Specifies a path to the desired [<abbr title="User Interface">UI</abbr> bundle](https://docs.antora.org/antora/1.0/playbook/configure-ui/#ui-bundle) (`--ui-bundle-url`)
- Specifies [the site URL](https://docs.antora.org/antora/1.0/playbook/configure-site/#configure-url) (`--url`), e.g., `http://localhost:5000`. This setting is used as a prefix for the internal URLs that Antora generates from [the Xrefs](https://docs.antora.org/antora/1.0/asciidoc/page-to-page-xref/#xref-and-page-id-anatomy), e.g., `http://localhost:5000/server/administration_manual/upgrading/marketplace_apps.html` or `file:///home/antora/workspace/owncloud/server/administration_manual/upgrading/marketplace_apps.html`.


`ui-bundle-url` is required, as this isn't specified in the production Playbook file (_which is in the root directory of the project_).
The other options, however, are optional.
If you've created a custom Playbook file, feel free to use it when running the command, in place of `site.prod.yml` (_which is in the root directory of the project_).

### Viewing The HTML Documentation

Assuming that there are no errors, the next thing to do is to run the [NPM Serve tool](https://www.npmjs.com/package/serve) so that you can view your changes, before committing and pushing the changes to the remote docs repository.
We suggest using it, as it's trivial to install and start.
You could also use [PHP's built-in webserver](https://secure.php.net/manual/en/features.commandline.webserver.php) as well.
By using either of these, you don't have to install and configure a complete webserver, such as Apache or NGINX.

To start *Serve*, run the following command:

```
serve public &
```

This starts Serve and set it running in the background, using the `public` directory, (re)generated by `antora site.yml`, as the document root, listening on `http://localhost:5000`.
_The URL is automatically copied to the clipboard._

![Viewing the Antora docs with NPM serve](./images/viewing-the-antora-docs-with-npm-serve.png)

Open the URL in your browser of choice and you'll see two links, as below.

![The initial page in the local copy of the Antora-generated documentation](./images/antora-initial-local-page.png)

Click "**server/**", and you'll see the local copy of the documentation.

![Viewing the locally generated Antora documentation](./images/viewing-the-locally-generated-antora-documentation.png)

If you're happy with your changes, as with any other change, create a set of meaningful commits and push them to the remote repository.
If you're _not_ satisfied with the changes, however, continue to make further updates, as necessary, and run `antora site.yml` afterwards.
Your changes will be reflected in the local version of the site that Serve is rendering.

We hope that you can see that contributing to the documentation using Antora is a pretty straight-forward process, and not _that_ demanding.

## Generating in PDF Format

To generate the documentation in PDF format, you need to have `asciidoctor-pdf` and GNU `make` installed, as PDF generation isn't, _yet_, supported by Antora.
To install asciidoctor-pdf, please refer to [the official installation instructions](https://asciidoctor.org/docs/asciidoctor-pdf/).
To install GNU Make, please refer to the link below for your operating system:

- [Linux](https://www.cyberciti.biz/faq/howto-installing-gnu-c-compiler-development-environment-on-ubuntu/)
- [macOS](http://brewformulas.org/Make)
- [Microsoft Windows](http://gnuwin32.sourceforge.net/install.html)

When installed, run the command below in the root directory of the repository, to generate PDF versions of the _administration_, _developer_ and _user_ manuals.

```console
make pdf
```

`make pdf` invokes [asciidoctor-pdf](https://github.com/asciidoctor/asciidoctor-pdf) and passes it:

1. **The configuration file to use**

    This configuration file, based on [the asciidoctor-pdf theming guide](https://github.com/asciidoctor/asciidoctor-pdf/blob/master/docs/theming-guide.adoc), contains all the essential details required to build a PDF version of one of the manuals.

    This includes the list of files to use as the PDF's source material as well as the required YAML front-matter. The front-matter includes details such as whether to render a table of contents, the icon set to use, and the images base directory.

2. **The custom theme directory and the custom theme file**

    This ensures that the defaults are overridden, where relevant, to ensure that the generated PDF is as close to the current ownCloud style as possible.

When generated, the PDF files will be generated in the build directory (`build`), and will be named after the respective manual.
The build directory is called `build` and is located in the root of the repository.

## Viewing Build Errors

If an aspect of your change contains invalid AsciiDoc, then you'll see output similar to the example below.

```console
asciidoctor: ERROR: index.adoc: line 25: only book doctypes can contain level 0 sections
```

There, you can see:

- That an error was found
- The file it was found in
- The line of that file where it is located
