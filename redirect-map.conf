map_hash_max_size 262144;
map_hash_bucket_size 262144;
map $request_uri $redirect_uri {
    # Handle a revised content structure
    /android_app/ /android_app/android_app_app.html;
    /ios/ /ios/ios_app.html;
    /desktop/latest/advanced_usage.html /desktop/advanced_usage/options.html;
    /desktop/latest/autoupdate.html /desktop/automatic_updater.html;
    /server/latest/admin_manual/installation/source_installation.html /server/10.0/administration_manual/installation/manual_installation.html;
    /server/latest/user_manual/files/troubleshooting.html /server/10.0/user_manual/troubleshooting.html;
    /server/latest/user_manual/pim/troubleshooting.html /server/10.0/user_manual/troubleshooting.html;
    /server/latest/developer_manual/commun/ /server/10.0/developer_manual/commun/help_and_communication.html;
    /server/latest/developer_manual/app/ /server/10.0/developer_manual/app/introduction.html;

    # Redirect all other files in the latest copy of the old docs to the new docs
    ~/server/latest/admin_manual/(.*) /server/10.0/administration_manual/$1;
    ~/server/latest/(user|developer)_manual/(.*) /server/10.0/$1_manual/$2;
    ~/desktop/latest/(.*) /client/$1;

    # Redirect all older content to the older version of the docs
    ~/server/([0-9]+\.[0-9]+)/(developer|user|admin)_manual/(.*) https://doc-old.owncloud.com/server/$1/$2_manual/$3;
    ~/desktop/([0-9]+\.[0-9]+)/(.*) https://doc-old.owncloud.org/desktop/$1/$2;

    # Not sure if these are required.
    #/server/latest/admin_manual/issues/ /server/10.0/administration_manual/issues/index.html;
    #/server/latest/admin_manual/installation/ /server/10.0/administration_manual/installation/index.html;
    #/server/latest/admin_manual/installation/docker/ /server/10.0/administration_manual/installation/docker/index.html;
    #/server/latest/admin_manual/installation/letsencrypt/ /server/10.0/administration_manual/installation/letsencrypt/index.html;
    #/server/latest/admin_manual/upgrading/ /server/10.0/administration_manual/upgrading/index.html;
    #/server/latest/admin_manual/configuration/ /server/10.0/administration_manual/configuration/index.html;
    #/server/latest/admin_manual/configuration/database /server/10.0/administration_manual/configuration/database/index.html;
    #/server/latest/admin_manual/configuration/files /server/10.0/administration_manual/configuration/files/index.html;
    #/server/latest/admin_manual/configuration/mimetypes /server/10.0/administration_manual/configuration/mimetypes/index.html;
    #/server/latest/admin_manual/configuration/server /server/10.0/administration_manual/configuration/server/index.html;
    #/server/latest/admin_manual/configuration/user /server/10.0/administration_manual/configuration/user/index.html;
    #/server/latest/admin_manual/maintenance/ /server/10.0/administration_manual/maintenance/index.html;
    #/server/latest/user_manual/files/ /server/user_manual/files/index.html;
    #/server/latest/user_manual/pim/ /server/user_manual/pim/index.html;
    #/server/latest/developer_manual/app/fundamentals/ /server/developer_manual/app/fundamentals/index.html;
    #/server/latest/developer_manual/app/advanced/ /server/developer_manual/app/advanced/index.html;
    #/server/latest/developer_manual/app/tutorial/ /server/developer_manual/app/tutorial/index.html;
    #/server/latest/developer_manual/core/ /server/developer_manual/core/index.html;
    #/server/latest/developer_manual/app/general/ /server/developer_manual/general/index.html;
    #/server/latest/developer_manual/mobile_development/ /server/developer_manual/mobile_development/index.html;
    #/server/latest/developer_manual/mobile_development/android_library/ /server/developer_manual/mobile_development/android_library/index.html;
    #/server/latest/developer_manual/mobile_development/ios_library/ /server/developer_manual/mobile_development/ios_library/index.html;
    #/server/latest/developer_manual/bugtracker/ /server/developer_manual/bugtracker/index.html;
}
